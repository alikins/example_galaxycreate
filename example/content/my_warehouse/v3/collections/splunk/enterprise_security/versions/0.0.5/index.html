<h1>Splunk Enterprise Security Ansible Collection</h1>
<h2>Tech Preview</h2>
<p>Using splunk modules are meant to be used with the <a href="https://docs.ansible.com/ansible/latest/plugins/connection/httpapi.html"><code>httpapi</code> connection
plugin</a>
and as such we will set certain attributes in the inventory</p>
<p>Example <code>inventory.ini</code>:</p>
<p>NOTE: The passwords should be stored in a secure location or an <a href="https://docs.ansible.com/ansible/latest/user_guide/vault.html">Ansible
Vault</a></p>
<p>NOTE: the default port for Splunk's REST API is 8089</p>
<pre><code>[splunk]
splunk.example.com

[splunk:vars]
ansible_network_os=splunk
ansible_user=admin
ansible_httpapi_pass=my_super_secret_admin_password
ansible_httpapi_port=8089
ansible_httpapi_use_ssl=yes
ansible_httpapi_validate_certs=True
ansible_connection=httpapi
</code></pre>
<p>Example playbook:</p>
<h2>License</h2>
<p>GPLv3</p>
<h2>Author Information</h2>
<p><a href="https://github.com/ansible-security">Ansible Security Automation Team</a>
This is the <a href="https://docs.ansible.com/ansible/devel/collections_tech_preview.html">Ansible
Collection</a>
provided by the <a href="https://github.com/ansible-security">Ansible Security Automation
Team</a> for automating actions in <a href="https://www.splunk.com/en_us/software/enterprise-security.html">Splunk
Enterprise Security
SIEM</a></p>
<p>This Collection is meant for distribution via
<a href="https://galaxy.ansible.com/">Ansible Galaxy</a> as is available for all
<a href="https://github.com/ansible/ansible">Ansible</a> users to utilize, contribute to,
and provide feedback about.</p>
<h3>Using Splunk Enterprise Security Ansible Collection</h3>
<p>An example for using this collection to manage a log source with <a href="https://www.splunk.com/en_us/software/enterprise-security.html">Splunk Enterprise Security SIEM</a> is as follows.</p>
<p><code>inventory.ini</code> (Note the password should be managed by a <a href="https://docs.ansible.com/ansible/latest/user_guide/vault.html">Vault</a> for a production environment.</p>
<pre><code>[splunk]
splunk.example.com

[qradar:vars]
ansible_network_os=splunk.enterprise_security.splunk
ansible_user=admin
ansible_httpapi_pass=my_super_secret_admin_password
ansible_httpapi_port=8089
ansible_httpapi_use_ssl=yes
ansible_httpapi_validate_certs=True
ansible_connection=httpapi
</code></pre>

<h4>Define your collection search path at the Play level</h4>
<p>Below we specify our collection at the Play level which allows us to use the
splunk modules without specifying the need for the
Ansible Collection Namespace.</p>
<p><code>splunk_with_collections_example.yml</code></p>
<pre><code>---
- name: demo splunk
  hosts: splunk
  gather_facts: False
  collections:
    - splunk.enterprise_security
  tasks:
    - name: test splunk_data_input_monitor
      ansible_security.collection.splunk_data_input_monitor:
        name: &quot;/var/log/demo.log&quot;
        state: &quot;present&quot;
        recursive: True
    - name: test splunk_data_input_network
      ansible_security.collection.splunk_data_input_network:
        name: &quot;9001&quot;
        protocol: &quot;tcp&quot;
        state: &quot;absent&quot;
    - name: test splunk_coorelation_search
      ansible_security.collection.splunk_correlation_search:
        name: &quot;Test Demo Coorelation Search From Playbook&quot;
        description: &quot;Test Demo Coorelation Search From Playbook, description.&quot;
        search: 'source=&quot;/var/log/snort.log&quot;'
        state: &quot;present&quot;
    - name: test splunk_adaptive_response_notable_event
      ansible_security.collection.splunk_adaptive_response_notable_event:
        name: &quot;Demo notable event from playbook&quot;
        correlation_search_name: &quot;Test Demo Coorelation Search From Playbook&quot;
        description: &quot;Test Demo notable event from playbook, description.&quot;
        state: &quot;present&quot;
        next_steps:
          - ping
          - nslookup
        recommended_actions:
          - script
</code></pre>

<h4>Define your collection search path at the Block level</h4>
<p>Below we use the <a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_blocks.html"><code>block</code></a>
level keyword, we are able to use the splunk modules without the need for the
Ansible Collection Namespace.</p>
<p><code>splunk_with_collections_block_example.yml</code></p>
<pre><code>---
- name: demo splunk
  hosts: splunk
  gather_facts: False
  tasks:
    - name: collection namespace block
      - name: test splunk_data_input_monitor
        ansible_security.collection.splunk_data_input_monitor:
          name: &quot;/var/log/demo.log&quot;
          state: &quot;present&quot;
          recursive: True
      - name: test splunk_data_input_network
        ansible_security.collection.splunk_data_input_network:
          name: &quot;9001&quot;
          protocol: &quot;tcp&quot;
          state: &quot;absent&quot;
      - name: test splunk_coorelation_search
        ansible_security.collection.splunk_correlation_search:
          name: &quot;Test Demo Coorelation Search From Playbook&quot;
          description: &quot;Test Demo Coorelation Search From Playbook, description.&quot;
          search: 'source=&quot;/var/log/snort.log&quot;'
          state: &quot;present&quot;
      - name: test splunk_adaptive_response_notable_event
        ansible_security.collection.splunk_adaptive_response_notable_event:
          name: &quot;Demo notable event from playbook&quot;
          correlation_search_name: &quot;Test Demo Coorelation Search From Playbook&quot;
          description: &quot;Test Demo notable event from playbook, description.&quot;
          state: &quot;present&quot;
          next_steps:
            - ping
            - nslookup
          recommended_actions:
            - script
      collections:
        - splunk.enterprise_security
</code></pre>

<h3>Directory Structure</h3>
<ul>
<li><code>docs/</code>: local documentation for the collection</li>
<li><code>license.txt</code>: optional copy of license(s) for this collection</li>
<li><code>galaxy.yml</code>: source data for the MANIFEST.json that will be part of the collection package</li>
<li><code>playbooks/</code>: playbooks reside here</li>
<li><code>tasks/</code>: this holds 'task list files' for <code>include_tasks</code>/<code>import_tasks</code> usage</li>
<li><code>plugins/</code>: all ansible plugins and modules go here, each in its own subdir</li>
<li><code>modules/</code>: ansible modules</li>
<li><code>lookups/</code>: lookup plugins</li>
<li><code>filters/</code>: Jinja2 filter plugins</li>
<li>... rest of plugins</li>
<li><code>README.md</code>: information file (this file)</li>
<li><code>roles/</code>: directory for ansible roles</li>
<li><code>tests/</code>: tests for the collection's content</li>
</ul>